(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-26899159"],{"45be":function(t,e,a){"use strict";a("a14a")},a14a:function(t,e,a){},ca9d:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"rbt-bank"},[a("div",{staticClass:"r-panel"},[t._m(0),a("div",{staticClass:"rbt-info"},[a("div",{staticClass:"name"},[t._v("我的RBT余额")]),a("div",{staticClass:"data"},[t._v(" "+t._s(t.RBT)+"RBT ")])]),a("div",{staticClass:"rbt-value"},[a("div",{staticClass:"name"},[t._v(" 价值 (BTC) ")]),a("div",{staticClass:"data"},[t._v(" "+t._s(t._f("formatNumber")((t.RBT/t.btcPrice).toFixed(2)))+" "),a("span",{staticClass:"btc-value"},[t._v("≈$ "+t._s(.4*t.RBT))])])]),a("div",{staticClass:"stake-btn",on:{click:function(e){t.dialogVisible=!0}}},[t._v(" STAKE ")])]),a("RainbowPanel",{staticClass:"rainCard-box",scopedSlots:t._u([{key:"name",fn:function(){return[a("div",{staticClass:"bank-panel-header"},[a("span",[t._v("我的RBT资产")]),a("span",{staticClass:"erc-info erc-info-r"},[t._v("ERC20")])])]},proxy:!0},{key:"content",fn:function(){return[a("div",{staticClass:"pledge"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoadingT,expression:"isLoadingT"}],attrs:{data:t.accountData,border:"",align:"center","show-summary":""}},[a("el-table-column",{attrs:{prop:"name",label:"类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.name)+" ")]}}])}),a("el-table-column",{attrs:{prop:"available",label:"可用RBT"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[t._v(" "+t._s(t._f("formatNumberTo")(parseFloat(e.row.available)))+" ")])}}])}),a("el-table-column",{attrs:{prop:"waitExtract",label:"待提取RBT"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[t._v(" "+t._s(t._f("formatNumberTo")(parseFloat(e.row.waitExtract)))+" ")])}}])}),a("el-table-column",{attrs:{prop:"locked",label:"锁仓中RBT"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{},[t._v(" "+t._s(t._f("formatNumberTo")(parseFloat(e.row.locked)))+" ")])}}])})],1)],1)]},proxy:!0}])}),a("RainbowPanel",{staticClass:"rbt-deposit",scopedSlots:t._u([{key:"name",fn:function(){return[a("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[a("span",{staticStyle:{"font-size":"18px"}},[t._v("我的RBT-deposit "),a("span",{staticClass:"erc-info"},[t._v("ERC721")])]),a("el-button",{staticClass:"button-view",attrs:{size:"mini"},on:{click:function(e){t.isShowRecord=!0}}},[t._v(" 已过期 ")])],1)]},proxy:!0},{key:"content",fn:function(){return[t.bankTokenArr.length>0&&t.updateTable?t._l(t.bankTokenArr,(function(e){return a("div",{key:e.index},[a("TableItem",{attrs:{tableData:e,operateRName:"取款"},on:{operateRClick:t.operateRClick}})],1)})):t._e()]},proxy:!0}])}),a("el-dialog",{staticClass:"dialog",attrs:{title:"质押",visible:t.dialogVisible,width:"380px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"line"},[a("strong",[t._v("质押类型")]),a("el-select",{staticClass:"select",attrs:{placeholder:"请选择质押月份",size:"mini"},on:{change:t.monthChange},model:{value:t.chooseMonth,callback:function(e){t.chooseMonth=e},expression:"chooseMonth"}},t._l(t.monthsArr,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("div",{staticClass:"line"},[a("strong",[t._v("质押资产")]),t._v(" "),a("span")]),a("div",{staticClass:"line"},[a("span",[t._v("我的RBT")]),t._v(" "),a("span",[t._v("Balance: "+t._s(t.RBT)+" RBT")])]),a("div",{staticClass:"input-box"},[a("el-input",{staticClass:"input2",class:{active:t.subAmount[0]>0},attrs:{size:"small"},model:{value:t.amount,callback:function(e){t.amount=e},expression:"amount"}}),a("el-button",{on:{click:function(e){return t.setMax(0)}}},[t._v("MAX")])],1),a("div",{staticClass:"line"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),a("el-button",{on:{click:t.pledge}},[t._v("质押")])],1)])],1)},o=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"icon"},[s("img",{attrs:{src:a("ca46"),alt:""}})])}],n=a("1da1"),i=a("5530"),r=(a("96cf"),a("159b"),a("d3b7"),a("c1df")),c=a.n(r),l=a("2f62"),u=a("8000"),h={name:"RBTBank",data:function(){return{updateTable:!1,subAmount:[0,0,0,0,0],balanceArr:[0,0,0,0,0],amount:0,RBT:0,arr1:[],arr2:[],dialogVisible:!1,monthsArr:[{label:"活期",value:0},{label:"三个月",value:3},{label:"六个月",value:6},{label:"十二个月",value:12},{label:"二十四个月",value:24},{label:"三十六个月",value:36}],chooseMonth:null,selectIndex:null,allowance:0,isShowRecord:!1,accountData:[],isLoadingT:!1,isLoadingT2:!1}},created:function(){this.initData()},computed:Object(i["a"])(Object(i["a"])({},Object(l["b"])(["isConnected","account","btcPrice","web3"])),{},{bankTokenArr:function(){var t=[];return this.$store.state.rainbowBank.records.forEach((function(e,a){var s={index:a+1,nameObj:{title:"令牌编号",data:e.tokenId},infoArr:[{title:"锁仓类型",data:e.month+"个月"},{title:"包含RBT数量",data:e.amount},{title:"生成社区治理令牌总额度",data:""},{title:"目前还可以生成社区治理令牌额度",data:""}],detailArr:[{title:"初始生成人",data:e.depositor.substr(0,3)+"..."+e.depositor.substr(e.depositor.length-3,3)},{title:"现在所有人",data:e.depositor.substr(0,3)+"..."+e.depositor.substr(e.depositor.length-3,3)},{title:"生成时间",data:c()(e.created_at).format("YYYY-MM-DD")},{title:"到期时间",data:c()(e.updated_at).format("YYYY-MM-DD")},{title:"剩余天数",data:30*e.month}],withdrawa:{address:e.depositor,tokenid:e.tokenId}};t.push(s)})),t},excRecords:function(){return this.$store.state.seedExc.records},consensusRecords:function(){return this.$store.state.consensus.records},contributionRecords:function(){return this.$store.state.contribution.records},inviteRecords:function(){return this.$store.state.invite.records},seedExcA:function(){return.9*this.$store.state.seedExc.totalExc-this.$store.state.seedExc.extracted},consensusA:function(){return this.$store.state.consensus.getRbtRecord.lockNum+this.$store.state.consensus.getRbtRecord.extractable},contributionA:function(){return this.$store.state.contribution.getRbtRecord.lockNum+this.$store.state.contribution.getRbtRecord.extractable}}),watch:{isConnected:function(){this.initData()}},methods:{monthChange:function(){switch(this.chooseMonth){case 0:this.balanceArr[1]=0,this.balanceArr[2]=0,this.balanceArr[3]=0;break;case 3:this.balanceArr[1]=Math.floor(this.seedExcA/3),this.balanceArr[2]=Math.floor(this.consensusA/3),this.balanceArr[3]=Math.floor(this.contributionA/3);break;case 6:this.balanceArr[1]=Math.floor(this.seedExcA/2),this.balanceArr[2]=Math.floor(this.consensusA/2),this.balanceArr[3]=Math.floor(this.contributionA/2);break;case 9:this.balanceArr[1]=Math.floor(2*this.seedExcA/3),this.balanceArr[2]=Math.floor(2*this.consensusA/3),this.balanceArr[3]=Math.floor(2*this.contributionA/3);break;case 12:case 24:case 36:this.balanceArr[1]=this.$store.state.seedExc.totalExc-this.$store.state.seedExc.extracted,this.balanceArr[2]=this.$store.state.consensus.getRbtRecord.allRbt,this.balanceArr[3]=this.$store.state.contribution.getRbtRecord.allRbt}},setMax:function(){this.amount=this.RBT},getDeposit:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.isLoadingT2=!0,e.next=3,t.$store.dispatch("RbtDeposit721/tokenMetadata",1);case 3:t.isLoadingT2=!1;case 4:case"end":return e.stop()}}),e)})))()},getRecord:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.getDeposit(),t.isLoadingT=!0,t.isLoadingT=!1,t.balanceArr[0]=t.$store.state.erc20.RBT,t.accountData=[{name:"钱包",available:t.$store.state.erc20.RBT,waitExtract:0,locked:0},{name:"种子轮兑换矿池",available:t.$store.state.seedExc.totalExc-t.$store.state.seedExc.extracted,waitExtract:t.$store.state.seedExc.released-t.$store.state.seedExc.extracted,locked:t.$store.state.seedExc.totalExc-t.$store.state.seedExc.released},{name:"共识挖矿矿池",available:t.$store.state.consensus.getRbtRecord.allRbt,waitExtract:t.$store.state.consensus.getRbtRecord.extractable,locked:t.$store.state.consensus.getRbtRecord.lockNum},{name:"贡献挖矿矿池",available:t.$store.state.contribution.getRbtRecord.allRbt,waitExtract:t.$store.state.contribution.getRbtRecord.extractable,locked:t.$store.state.contribution.getRbtRecord.lockNum}];case 5:case"end":return e.stop()}}),e)})))()},initData:function(){var t=this;this.isConnected&&(this.$store.dispatch("rainbowBank/getInfo").then((function(){t.updateTable=!0})),this.$store.dispatch("RBT/balanceOf",this.account).then((function(e){t.RBT=e/Math.pow(10,18)})))},checkLimit:function(){this.accountData[0].extract>this.accountData[0].available&&(this.accountData[0].extract=this.accountData[0].available)},chooseMax:function(t){this.accountData[t].extract=this.accountData[t].available,this.$set(this.accountData,t,this.accountData[t])},chooseRecord:function(){var t=this,e=[],a=[],s=0;parseFloat(this.subAmount[1])>0&&this.excRecords.forEach((function(o){if(s+=(.9*o.amount-o.extracted)*t.chooseMonth/12,s<parseFloat(t.subAmount[1]))return e.push(o.xuhao),void a.push((.9*o.amount-o.extracted)*t.chooseMonth/12);e.push(o.xuhao),a.push(parseFloat(t.subAmount[1])-s+(.9*o.amount-o.extracted)*t.chooseMonth/12)})),this.arr1=[],this.arr2=[],this.arr1.push(e),this.arr2.push(a),e=[],a=[],s=0,parseFloat(this.subAmount[2])>0&&this.consensusRecords.forEach((function(o){if(s+=(.9*o.amount-o.extracted)*t.chooseMonth/12,s<parseFloat(t.subAmount[2]))return e.push(o.xuhao),void a.push((.9*o.amount-o.extracted)*t.chooseMonth/12);e.push(o.xuhao),a.push(parseFloat(t.subAmount[2])-s+(.9*o.amount-o.extracted)*t.chooseMonth/12)})),this.arr1.push(e),this.arr2.push(a),e=[],a=[],s=0,parseFloat(this.subAmount[3])>0&&this.inviteRecords.forEach((function(o){if(s+=(.9*o.amount-o.extracted)*t.chooseMonth/12,s<parseFloat(t.subAmount[3]))return e.push(o.xuhao),void a.push((.9*o.amount-o.extracted)*t.chooseMonth/12);e.push(o.xuhao),a.push(parseFloat(t.subAmount[3])-s+(.9*o.amount-o.extracted)*t.chooseMonth/12)})),this.arr1.push(e),this.arr2.push(a)},pledge:function(){var t=this;if(this.account&&this.account.length<=0)this.$message("请先连接钱包");else if(null!=this.chooseMonth){var e=this.account;this.$store.dispatch("RBT/allowance",{owner:e,spender:u["RainbowBank"]}).then((function(e){if(e<t.amount)return t.isLoading=!0,void t.$store.dispatch("RBT/approve",{spender:u["RainbowBank"],amount:t.web3.utils.toWei(Math.pow(10,18).toString())}).then((function(){t.isLoading=!1,t.subPledge()})).catch((function(){t.isLoading=!1,t.$message({type:"error",message:"授权失败"})}));t.subPledge()}))}else this.$message("请选择存几个月")},operateRClick:function(t){this.release(t.withdrawa.tokenid)},release:function(t){var e=this;console.log(t,this.account),this.$store.dispatch("RainbowBank/withdrawa",{to:this.account,tokenId:t}).then((function(){e.$message.success("提取成功")})).catch((function(t){e.$message.error("提取失败"+t)}))},subPledge:function(){var t=this;this.$store.dispatch("RainbowBank/depositToken",{to:this.account,month:this.chooseMonth,value:this.amount}).then((function(){t.$message.success("质押成功"),t.dialogVisible=!1;var e=t.$store.state.rainbowBank.records;e.push({month:t.chooseMonth,tokenId:t.bankTokenArr.length+1,created_at:new Date,depositor:t.account,amount:t.amount}),t.$store.commit("rainbowBank/SET_RECORDS",e),t.subAmount=[0,0,0,0,0]})).catch((function(e){console.log(e),t.$message.error("质押失败"+e)}))}}},d=h,b=(a("45be"),a("2877")),p=Object(b["a"])(d,s,o,!1,null,"51816e5b",null);e["default"]=p.exports}}]);
//# sourceMappingURL=chunk-26899159.7304e90c.js.map